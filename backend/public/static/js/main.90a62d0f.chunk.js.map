{"version":3,"sources":["constants/constants.js","components/sliderItem/index.js","components/main/BootstrapSlider/index.js","components/main/index.js","components/gallery/sliderDesk/slideWrapper/index.js","components/gallery/sliderDesk/index.js","components/gallery/index.js","components/pageNotFound/index.js","redux-components/containers/pageNotFoundContainer.js","components/map/marker/index.js","components/map/informationPanel/index.js","components/map/mapLoader/index.js","components/map/settingPanel/index.js","components/map/audioPlayer/index.js","components/map/index.js","redux-components/actions/index.js","components/authorization/index.js","redux-components/containers/authorizationContainer.js","components/registration/index.js","redux-components/containers/registrationContainer.js","routes/index.js","components/header/index.js","redux-components/containers/headerContainer.js","components/footer/index.js","serviceWorker.js","redux-components/reducers/index.js","index.js"],"names":["BACKEND_PREFIX","API_PREFIX","MAPS_PREFIX","AUTH_PREFIX","LOGIN_ENDPOINT","REGISTER_ENDPOINT","CURRENT_USER_ENDPOINT","sliderItem","map_name","title","description","thumbnail","id","url","to","className","style","background","Constants","BootstrapSlider","props","next","state","animating","nextIndex","activeIndex","items","length","setState","previous","goToIndex","newIndex","fetch","then","response","json","data","catch","err","console","log","Carousel","this","CarouselIndicators","onClickHandler","map","item","CarouselItem","tag","key","onExiting","onExited","CarouselControl","direction","directionText","Component","Main","Fragment","href","slideWrapper","task","SliderDesk","Gallery","PageNotFound","ready","height","PageNotFoundContainer","connect","dispatch","get_data","sign","result","radius","cursor_pointer","document","getElementsByTagName","cursor","cursor_default","marker","mark_props","x","x_coordinate","y","y_coordinate","onClick","handler","opacity","onMouseEnter","onMouseLeave","reset","from","fill","animation_props","Circle","stroke","width","InformationPanel","margin_left","show","source","node","type","content","src","draggable","dangerouslySetInnerHTML","__html","renderNode","MapLoader","window","innerWidth","SettingPanel","e","eye","currentTarget","brow","children","traverser","changeVisability","borderColor","color","son","querySelector","changePlaying","showSummary","AudioPlayer","audio_map","tracks","split","i","trim","col","row","to_array","forEach","track","file","to_dict","player","Audio","timer","loop","j","willPlay","currentPlay","stopped","clearTimeout","pause","currentTime","setTimeout","track_id","play_promise","play","undefined","error","message","Map","handleLoad","loaded","handleWindowLoad","preventDefault","innerHeight","clientHeight","changeMarkersVisability","markersView","inform","imageData","map_description_items","markersOpacity","bound_function","position","visible_width","visible_height","current_height","stageScale","current_width","new_x","new_y","handleWheel","evt","stage","target","getStage","oldScale","scaleX","mousePointTo","getPointerPosition","newScale","deltaY","minScaleValue","scale","stageX","stageY","layer","getChildren","absolutePosition","handleClick","index","scrollTop","marks","mark_description_items","handleBack","handleMove","x_pointer_position","y_pointer_position","backgroundPlayer","change","Math","trunc","horizontal_parts_count","vertical_parts_count","soundEffectsPlayer","horizontal_parts_effects_count","vertical_parts_effects_count","handleLeave","map_leaved","match","params","found","image","interacted","React","createRef","bind","processLayerPosition","name","status","stageScaleValue","min","stageXValue","map_image","Image","addEventListener","volume","parts","effects","effects_map","display","stop","markers","Object","assign","unstop","getMarginLeft","onWheel","scaleY","dragBoundFunc","onMouseMove","ref","setUserData","user_data","user_name","username","user_email","email","user_profile","profile","AuthorizationForm","handleChange","a","value","submitForm","login","password","method","headers","body","JSON","stringify","ok","Promise","reject","localStorage","setItem","enter","user","keys","error_array","errorText","Label","Form","onSubmit","FormGroup","for","Input","placeholder","onChange","Button","AuthorizationFormContainer","RegistrationForm","size","RegistartionFormContainer","RegistartionForm","withRouter","exact","path","component","RegistrationFormContainer","Header","handleWindow","setHeight","logged_in","getItem","res","userDiv","onEscapeClick","HeaderContainer","removeItem","Footer","Boolean","location","hostname","initialState","reducer","action","store","createStore","ReactDOM","render","getElementById","navigator","serviceWorker","registration","unregister"],"mappings":"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","file":"static/js/main.90a62d0f.chunk.js","sourcesContent":["// Working with backend\r\nexport const BACKEND_PREFIX = 'http://localhost:8000';\r\nexport const API_PREFIX = `${BACKEND_PREFIX}/api`;\r\nexport const MAPS_PREFIX = `${API_PREFIX}/maps`;\r\nexport const AUTH_PREFIX = `${API_PREFIX}/auth`;\r\nexport const LOGIN_ENDPOINT = `${AUTH_PREFIX}/token/`;\r\nexport const REGISTER_ENDPOINT = `${AUTH_PREFIX}/register/`;\r\nexport const CURRENT_USER_ENDPOINT = `${AUTH_PREFIX}/current_user/`;\r\n","import React from 'react';\r\nimport { Link } from \"react-router-dom\";\r\nimport './styles.css';\r\nimport * as Constants from \"../../constants/constants\";\r\n\r\nconst address = (map_name) => (\r\n    'maps/' + map_name\r\n);\r\n\r\nconst sliderItem = ({title, description, thumbnail, id, url}) => (\r\n    <Link to={address(url)}>\r\n        <div className=\"slider-item\" id={id} style={\r\n            {\r\n                background: `url(${Constants.BACKEND_PREFIX}${thumbnail}) center center no-repeat`\r\n            }\r\n        } >\r\n            <div className=\"shadow\">\r\n                <p className=\"title\">{title}</p>\r\n                <p className=\"description\">{description}</p>\r\n            </div>\r\n        </div>\r\n    </Link>\r\n);\r\n\r\nexport default sliderItem;","import 'bootstrap/dist/css/bootstrap.min.css';\r\n\r\nimport React, {Component} from 'react';\r\nimport {\r\n    Carousel,\r\n    CarouselItem,\r\n    CarouselControl,\r\n    CarouselIndicators\r\n} from 'reactstrap';\r\nimport sliderItem from \"../../sliderItem\";\r\nimport * as Constants from \"../../../constants/constants\";\r\n\r\n\r\nclass BootstrapSlider extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        // тут нет this.props.match.params могут ли быть потом от этого проблемы (с ними кидало ошибку)?\r\n        this.state = {\r\n            activeIndex: 0,\r\n            animating: false,\r\n            items: [],\r\n        };\r\n    };\r\n\r\n    componentDidMount() {\r\n        fetch(`${Constants.MAPS_PREFIX}/`)\r\n            .then(response => response.json())\r\n            .then(data => {\r\n                this.setState({items: data})\r\n            })\r\n            .catch(err => console.log('Send failed', err));\r\n    }\r\n\r\n    next = () => {\r\n        if (this.state.animating) return;\r\n        const nextIndex = this.state.activeIndex === this.state.items.length - 1 ? 0 : this.state.activeIndex + 1;\r\n        this.setState({activeIndex: nextIndex});\r\n    };\r\n\r\n    previous = () => {\r\n        if (this.state.animating) return;\r\n        const nextIndex = this.state.activeIndex === 0 ? this.state.items.length - 1 : this.state.activeIndex - 1;\r\n        this.setState({activeIndex: nextIndex});\r\n    };\r\n\r\n    goToIndex = (newIndex) => {\r\n        if (this.state.animating) return;\r\n        this.setState({activeIndex: newIndex});\r\n    };\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <style>\r\n                    {\r\n                        `.custom-tag {\r\n                          max-width: 100%;\r\n                          height: 274px;\r\n                          background: black;\r\n                    }`\r\n                    }\r\n                </style>\r\n                <Carousel\r\n                    activeIndex={this.state.activeIndex}\r\n                    next={this.next}\r\n                    previous={this.previous}\r\n                >\r\n                    <CarouselIndicators items={this.state.items} activeIndex={this.state.activeIndex}\r\n                                        onClickHandler={this.goToIndex}/>\r\n                    {this.state.items.map((item) => {\r\n                        return (\r\n                            <CarouselItem\r\n                                className=\"custom-tag\"\r\n                                tag=\"div\"\r\n                                key={item.id}\r\n                                onExiting={() => this.setState({animating: true})}\r\n                                onExited={() => this.setState({animating: false})}\r\n                            >\r\n                                {sliderItem(item)}\r\n                            </CarouselItem>\r\n                        );\r\n                    })}\r\n                    <CarouselControl direction=\"prev\" directionText=\"Previous\"\r\n                                     onClickHandler={this.previous}/>\r\n                    <CarouselControl direction=\"next\" directionText=\"Next\"\r\n                                     onClickHandler={this.next}/>\r\n                </Carousel>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n\r\nexport default BootstrapSlider;","import React, {Component} from 'react';\r\nimport BootstrapSlider from \"./BootstrapSlider\";\r\nimport './styles.css';\r\n\r\nclass Main extends Component {\r\n\r\n    render() {\r\n        return (\r\n            <React.Fragment>\r\n                {/*<Header/>*/}\r\n                <div className=\"content\">\r\n                    <main>\r\n                        <article>\r\n                            <div className=\"full-dark-logo\">\r\n                                Gaze\r\n                            </div>\r\n                            <h2>О проекте</h2>\r\n                            <p>\r\n                                Это проект по просмотру интерактивных карт. Возможность создания пока доступна лишь весьма ограниченному кругу лиц.\r\n                                На данный момент для просмотра доступны лишь три (см. Галерею), но мы убеждены, что они стоят вашего внимания. Желаем вам приятно и с пользой провести время ;)\r\n                            </p>\r\n                            <h2>Галерея</h2>\r\n                            <p>\r\n                                Ниже вы можете посмотреть несколько примеров интерактивных карт. В будущем еще больше можно будет найти на отдельной странице.\r\n                            </p>\r\n                            <div className=\"slider-wrapper\">\r\n                                <BootstrapSlider />\r\n                            </div>\r\n                            <h2>Авторы</h2>\r\n                            <p>\r\n                                Два студента МФТИ. См. на GitHub <a href=\"https://github.com/TulaShlyosberg\">TulaShloysberg</a> и <a href=\"https://github.com/Mr-Geekman/\">mrgeekman</a>.\r\n                            </p>\r\n                        </article>\r\n                    </main>\r\n                </div>\r\n                {/*<Footer/>*/}\r\n            </React.Fragment>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Main;\r\n","import React from 'react';\r\nimport './styles.css';\r\nimport sliderItem from \"../../../sliderItem\";\r\n\r\nconst slideWrapper = (task) => (\r\n    <div className=\"slide-wrapper\">\r\n        {sliderItem(task)}\r\n    </div>\r\n);\r\n\r\nexport default slideWrapper;","import React, {Component} from 'react';\r\nimport slideWrapper from \"./slideWrapper/index\";\r\nimport './styles.css'\r\nimport * as Constants from \"../../../constants/constants\";\r\n\r\n\r\nclass SliderDesk extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            items: []\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        fetch(`${Constants.MAPS_PREFIX}/`)\r\n            .then(response => response.json())\r\n            .then(data => {\r\n                console.log(data);\r\n                this.setState({items: data});\r\n            })\r\n            .catch(err => console.log('Send failed', err));\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"maps-table\">\r\n                {this.state.items.map(task => slideWrapper(task))}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default SliderDesk;","import React, {Component} from 'react';\r\nimport SliderDesk from './sliderDesk';\r\nimport './styles.css';\r\n\r\nclass Gallery extends Component {\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"content-gallery\">\r\n                <SliderDesk />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Gallery;","import React, {Component} from 'react';\r\nimport { Link } from \"react-router-dom\";\r\nimport './styles.css';\r\n\r\nclass PageNotFound extends Component {\r\n\r\n    constructor(props){\r\n        super(props);\r\n        this.state = {\r\n            ready: false\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.setState({ready: true});\r\n    }\r\n\r\n    render() {\r\n        if (!this.state.ready) {\r\n            return (\"404\");\r\n        }\r\n\r\n        return (\r\n            <div className=\"content-404\" style={\r\n                {\r\n                    height: this.props.height\r\n                }\r\n            }>\r\n                <div className=\"text-404\">\r\n                        <span>Похоже,</span><br/>\r\n                        <span>что вы забрели не туда,</span><br/>\r\n                        <span>такой страницы не существует</span><br/>\r\n                        <span>Советуем вернуться на <Link to=\"/\">главную</Link></span>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default PageNotFound;","import { connect } from 'react-redux';\r\nimport PageNotFound from '../../components/pageNotFound';\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n        height: state.height,\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch) => {} \r\n\r\nconst PageNotFoundContainer = connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(PageNotFound);\r\n\r\nexport default PageNotFoundContainer;","import React, {Component} from 'react';\r\nimport {Circle, Path, Group} from 'react-konva';\r\nimport {Spring, animated} from 'react-spring/renderprops-konva';\r\n\r\nfunction get_data(props, sign) {\r\n    let result = \"m 0, 0 q \";\r\n    result += props.radius + \",\" + \r\n        (sign * props.radius);\r\n    result += \" \" + (2 * props.radius) + \",\" + 0;\r\n    return result;\r\n}\r\n\r\nfunction cursor_pointer() {\r\n    document.getElementsByTagName('body')[0].style.cursor = 'pointer';\r\n}\r\n\r\nfunction cursor_default() {\r\n    document.getElementsByTagName('body')[0].style.cursor = 'default';\r\n}\r\n\r\nconst DOWN = 1;\r\nconst UP = -1;\r\n\r\n\r\nconst marker = mark_props => (<Group\r\n        x={mark_props.x_coordinate}\r\n        y={mark_props.y_coordinate}\r\n        onClick={mark_props.handler}        \r\n        opacity={0.8 * mark_props.opacity}\r\n        onMouseEnter={cursor_pointer}\r\n        onMouseLeave={cursor_default}\r\n        >\r\n        <Spring\r\n            reset\r\n            from={{fill: \"black\"}}\r\n            to= {{fill: \"gray\"}}\r\n        >\r\n            {animation_props => (\r\n            <animated.Circle \r\n                fill={animation_props.fill}\r\n                x={0}\r\n                y={0}\r\n                radius={mark_props.radius}\r\n            />)}\r\n        </Spring>\r\n        <Path \r\n            x={- mark_props.radius}\r\n            y={0}\r\n            data={get_data(mark_props, DOWN)}\r\n            stroke={\"white\"}\r\n            width={mark_props.radius / 4}\r\n        />\r\n        <Path \r\n            x={- mark_props.radius}\r\n            y={0}\r\n            data={get_data(mark_props, UP)}\r\n            stroke={\"white\"}\r\n            width={mark_props.radius / 4}\r\n        />\r\n        <Circle\r\n            x={0}\r\n            y={0}\r\n            radius={mark_props.radius / 3}\r\n            fill={\"white\"}\r\n        />\r\n    </Group>\r\n    );\r\n\r\nexport default marker;","import React, {Component} from 'react';\r\nimport * as Constants from \"../../../constants/constants\";\r\nimport './styles.css'\r\n\r\nfunction renderNode(node) {\r\n    switch (node.type) {\r\n        case 'h1':\r\n            return (\r\n                <h1>{node.content}</h1>\r\n            );\r\n        case 'h3':\r\n            return (\r\n                <h3>{node.content}</h3>\r\n            );\r\n        case 'img':\r\n            return (\r\n                <div>\r\n                    <img \r\n                        className={\"article-img\"} src={Constants.BACKEND_PREFIX +  node.src} \r\n                        draggable={\"false\"}\r\n                    />\r\n                    <div className={\"article-img-caption\"}>\r\n                        <i>{node.content}</i>\r\n                    </div>\r\n                </div>\r\n            );\r\n        case 'paragraph':\r\n            return (\r\n                <p>\r\n                <div dangerouslySetInnerHTML={{ __html: node.content}} />    \r\n                </p>\r\n            );\r\n        default:\r\n            return null;\r\n    }\r\n}\r\n\r\nclass InformationPanel extends Component {\r\n    constructor(props){\r\n        super(props);\r\n    }\r\n\r\n    render(){\r\n        let margin_left = \"100vw\";\r\n        if (this.props.show === 1){\r\n            margin_left = \"60vw\";\r\n        }\r\n\r\n        if (!this.props.source) {\r\n            return (\r\n                <div \r\n                    className={\"information-panel\"} \r\n                    style={\r\n                        {\r\n                            \"margin-left\": margin_left,\r\n                            height: this.props.height\r\n                        }\r\n                    }\r\n                >\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <div className={\"information-panel\"} style={\r\n                {\r\n                    \"margin-left\": margin_left,\r\n                    height: this.props.height\r\n                }\r\n            }>\r\n                {this.props.source.map(node => renderNode(node))}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default InformationPanel;","import React from 'react';\r\nimport './styles.scss';\r\n\r\n\r\nconst MapLoader = ({height}) => (\r\n        <div className={'map-loader-container'} style={{width: window.innerWidth, height:height}}>\r\n            <div className=\"loading-text\">\r\n                <span className=\"loading-text-words\">З</span>\r\n                <span className=\"loading-text-words\">А</span>\r\n                <span className=\"loading-text-words\">Г</span>\r\n                <span className=\"loading-text-words\">Р</span>\r\n                <span className=\"loading-text-words\">У</span>\r\n                <span className=\"loading-text-words\">З</span>\r\n                <span className=\"loading-text-words\">К</span>\r\n                <span className=\"loading-text-words\">А</span>\r\n            </div>\r\n        </div>\r\n);\r\n\r\nexport default MapLoader;","import './styles.css';\r\nimport React from 'react';\r\n\r\nconst SettingPanel = (props) => (\r\n    <div \r\n        className={\"setting-panel\"}\r\n        >\r\n        <div className={\"menu-button\"}>\r\n            <div className={\"line\"} />\r\n            <div className={\"line\"} />\r\n            <div className={\"line\"} />\r\n        </div>\r\n        <div \r\n            className={\"eye\"}\r\n            title=\"Скрыть/показать метки\"\r\n            onClick={\r\n                e => {\r\n                    let eye = e.currentTarget;\r\n                    let brow = eye.children[0];\r\n                    let traverser = eye.children[1];\r\n                    if (props.changeVisability()) {\r\n                        brow.style.borderColor = \r\n                            \"black transparent transparent transparent\";\r\n                        eye.style.color = \"black\";\r\n                        traverser.style.height = \"40px\";\r\n                        return;\r\n                    }\r\n                    eye.style.color = \"white\";\r\n                    brow.style.borderColor = \r\n                        \"white transparent transparent transparent\";\r\n                    traverser.style.height = \"0px\";\r\n                }\r\n            }\r\n        >\r\n            &bull;\r\n            <div className={\"brow\"} />\r\n            <div className={\"traverser\"} />\r\n        </div>\r\n        <div\r\n            className={\"speaker-sign\"}\r\n            onClick={() => {\r\n                let son = document.querySelector('.speaker-sign > .traverser');\r\n                if (props.changePlaying()) {\r\n                    son.style.height = \"40px\";\r\n                    return;\r\n                }\r\n                son.style.height = \"0px\";\r\n            }}\r\n        >\r\n            <div className={\"traverser\"} />\r\n        </div>\r\n        <div \r\n            className={\"inform-sign\"}\r\n            title=\"Описание карты\"\r\n            onClick={props.showSummary}\r\n        >\r\n            i\r\n        </div>\r\n    </div>\r\n);\r\n\r\nexport default SettingPanel;","import * as Constants from \"../../../constants/constants\";\r\n\r\nfunction to_array(audio_map) {\r\n    let result = audio_map.split(',');\r\n    for (let i in result) {\r\n        result[i] = (result[i].trim()).split(' ');\r\n    }\r\n    \r\n    //транспонируем массив\r\n    result = result[0].map((col, i) => result.map(row => row[i]));\r\n    return result;\r\n}\r\n\r\nfunction to_dict(tracks) {\r\n    let result = {}\r\n    tracks.forEach(track => {\r\n        result[track.id] = Constants.BACKEND_PREFIX + track.file;\r\n    });\r\n    return result;\r\n}\r\n\r\n\r\nclass AudioPlayer {\r\n    constructor (audio_map, tracks) {\r\n        this.audio_map = to_array(audio_map);\r\n        this.tracks = to_dict(tracks)\r\n        this.player = new Audio();\r\n        this.timer = null;\r\n        this.player.loop = true;\r\n        this.i = -1;\r\n        this.j = -1;\r\n        this.willPlay = 0;\r\n        this.currentPlay = 0;\r\n        this.stopped = 0;\r\n    }\r\n\r\n    stop() {\r\n        clearTimeout(this.timer);\r\n        this.player.pause();\r\n        this.player.currentTime = 0;\r\n        this.willPlay = 0;\r\n        this.currentPlay = 0;\r\n        this.i = -1;\r\n        this.j = -1;\r\n        this.stopped = 1;\r\n    }\r\n\r\n    unstop() {\r\n        this.stopped = 0;\r\n    }\r\n\r\n    map_leaved() {\r\n        clearTimeout(this.timer);\r\n        this.willPlay = this.currentPlay;\r\n    }\r\n\r\n    change(i, j) {\r\n        if (this.stopped) return;\r\n        if (this.i == -1 || this.audio_map[i][j] != this.audio_map[this.i][this.j]) {\r\n            this.i = i;\r\n            this.j = j;\r\n            this.willPlay = this.audio_map[i][j];\r\n            clearTimeout(this.timer);\r\n            if (this.willPlay != this.currentPlay) {\r\n                this.timer = setTimeout(track_id => {\r\n                    this.currentPlay = track_id;\r\n                    this.player.pause();\r\n                    if (this.audio_map[i][j] != \"_\") {\r\n                        this.player.src = this.tracks[track_id];\r\n                        this.player.currentTime = 0;\r\n                        let play_promise = this.player.play();\r\n                        \r\n                        if (play_promise != undefined) {\r\n                            play_promise.catch(error => {\r\n                                console.log(error.message);\r\n                            });\r\n                        }\r\n                    }\r\n                }, 2000, this.audio_map[i][j]);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport default AudioPlayer;","import React, {Component} from 'react';\r\nimport { Stage, Layer, Image } from 'react-konva';\r\n\r\nimport * as Constants from \"../../constants/constants\";\r\nimport PageNotFound from \"../../components/pageNotFound\";\r\n\r\nimport marker from \"./marker\"\r\nimport InformationPanel from \"./informationPanel\";\r\nimport MapLoader from \"./mapLoader\";\r\nimport SettingPanel from './settingPanel';\r\nimport AudioPlayer from './audioPlayer';\r\n\r\nimport './styles.css';\r\n\r\n\r\nclass Map extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {...this.props.match.params,\r\n            found: false, // найдена ли карта\r\n            loaded: false, // загружается изображение\r\n            stageY: 1,\r\n            height: 0,\r\n            imageData: {},\r\n            image: {},\r\n            markersOpacity: 1,\r\n            markersView: 1,\r\n            inform: null, // текущий элемента на информационной панели\r\n            stageScale: 1,\r\n            stageX: 1,\r\n            minScaleValue: 0,\r\n            interacted: 0,\r\n        };\r\n\r\n        this.layer = React.createRef();\r\n        this.vertical_parts_count = 0;\r\n        this.horizontal_parts_count = 0;\r\n\r\n        this.handleLoad = this.handleLoad.bind(this);\r\n        this.handleWindowLoad = this.handleWindowLoad.bind(this);\r\n        this.bound_function = this.bound_function.bind(this);\r\n        this.handleMove = this.handleMove.bind(this);\r\n        this.changeMarkersVisability = this.changeMarkersVisability.bind(this);\r\n        this.showSummary = this.showSummary.bind(this);\r\n        this.handleLeave = this.handleLeave.bind(this);\r\n        \r\n\r\n        // выравнивание Layer после render\r\n        this.processLayerPosition = layer => {\r\n            if (!layer) return;\r\n            layer.absolutePosition(\r\n                this.bound_function(\r\n                    layer.absolutePosition()\r\n                )\r\n            );\r\n        }\r\n    }\r\n\r\n\r\n    // загрузка изображения\r\n    handleLoad = () => {\r\n        this.setState({\r\n            loaded: true\r\n        });\r\n    };\r\n\r\n    //загрузка окна\r\n    handleWindowLoad = (e) => {\r\n        e.preventDefault();\r\n        let height = window.innerHeight - document.getElementsByTagName('header')[0].clientHeight -\r\n            document.getElementsByTagName('footer')[0].clientHeight;\r\n        this.setState({\r\n            height: height\r\n        });\r\n    };\r\n\r\n    changeMarkersVisability = () => {\r\n        this.setState({\r\n            markersView: 1 - this.state.markersView\r\n        });\r\n        return this.state.markersView;\r\n    }\r\n\r\n    showSummary = () => {\r\n        this.setState({\r\n            inform: this.state.imageData.map_description_items,\r\n            markersOpacity: 0\r\n        })\r\n    }\r\n\r\n    //ограничительная функция\r\n    //используется при перемещении и масштабировании\r\n    bound_function = (position) => {\r\n        let visible_width = window.innerWidth;\r\n        let visible_height = this.state.height;\r\n        let current_height = this.state.imageData.height * \r\n                            this.state.stageScale;\r\n        let current_width = this.state.imageData.width * \r\n                            this.state.stageScale;\r\n\r\n        let new_x = position.x;\r\n        let new_y = position.y;\r\n        if (current_height < visible_height) {\r\n            new_y = visible_height / 2 - current_height / 2;\r\n        }\r\n        else {\r\n            if (position.y > 0 ) new_y = 0;\r\n            if (position.y + current_height < visible_height)\r\n                new_y = visible_height - current_height;\r\n        }\r\n        if (current_width < visible_width) {\r\n            new_x = (visible_width - current_width) / 2\r\n        }\r\n        else {\r\n            if (position.x > 0) new_x = 0;\r\n            if (position.x + current_width < visible_width) \r\n                new_x = visible_width - current_width; \r\n        }\r\n    \r\n        return {x: new_x, y: new_y};\r\n    };\r\n\r\n    componentDidMount() {\r\n        let url = `${Constants.MAPS_PREFIX}/${this.state.name}/`;\r\n\r\n        fetch(url)\r\n            .then(response => {\r\n                if(response.status === 404) {\r\n                    this.setState({found: false, loaded: true});\r\n                } else if(response.status === 200) {\r\n                    return response.json();\r\n                }\r\n            })\r\n            .then(data => {\r\n                this.setState({ imageData: data });\r\n                if(this.state.imageData) {\r\n                    const stageScaleValue = Math.min(\r\n                        window.innerWidth / this.state.imageData.width,\r\n                        window.innerHeight / this.state.imageData.height * 0.8\r\n                    );\r\n                    this.setState({\r\n                        stageScale: stageScaleValue,\r\n                        minScaleValue: stageScaleValue\r\n                    });\r\n                    const stageXValue = (window.innerWidth -\r\n                        this.state.imageData.width * this.state.stageScale) / 2;\r\n                    this.setState({stageX: stageXValue});\r\n\r\n                    let map_image = new window.Image();\r\n                    map_image.src = Constants.BACKEND_PREFIX + this.state.imageData.image;\r\n                    map_image.addEventListener('load', this.handleLoad);\r\n                    this.setState({image: map_image, found: true});\r\n                    this.backgroundPlayer = new AudioPlayer(data.audio_map, data.tracks);\r\n                    this.backgroundPlayer.player.volume = 0.5;\r\n\r\n                    let parts = data.audio_map.split(',');\r\n                    this.vertical_parts_count = parts.length;\r\n                    this.horizontal_parts_count = (parts[0].trim()).split(' ').length;\r\n\r\n\r\n                    if (data.effects.length !== 0) {\r\n                        this.soundEffectsPlayer = new AudioPlayer(data.effects_map, data.effects);\r\n                        parts = data.effects_map.split(',')\r\n                        this.vertical_parts_effects_count = parts.length;\r\n                        this.horizontal_parts_effects_count = (parts[0].trim()).split(' ').length;\r\n                    }\r\n                }\r\n            })\r\n            .catch(err => console.log('Send failed', err));\r\n\r\n        if (document.getElementsByTagName('footer')) {\r\n            document.getElementsByTagName('footer')[0].style.display = 'none';\r\n        }\r\n        if (document.getElementsByTagName(\"footer\") &&\r\n            document.getElementsByTagName(\"header\")){\r\n            let height = window.innerHeight - document.getElementsByTagName('header')[0].clientHeight -\r\n                document.getElementsByTagName('footer')[0].clientHeight;\r\n            this.setState({\r\n                height: height\r\n            });\r\n        }\r\n        else {\r\n            window.addEventListener('load', this.handleWindowLoad);\r\n        }\r\n\r\n        \r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.getElementsByTagName('footer')[0].style.display = 'block';\r\n        this.backgroundPlayer.stop();\r\n        delete this.backgroundPlayer;\r\n        if (this.soundEffectsPlayer) {\r\n            this.soundEffectsPlayer.stop();\r\n            delete this.soundEffectsPlayer;\r\n        }\r\n    }\r\n\r\n\r\n    handleWheel = e => {\r\n        e.evt.preventDefault();\r\n\r\n        const scaleBy = 0.95;\r\n        const stage = e.target.getStage();\r\n        const oldScale = stage.scaleX();\r\n        const mousePointTo = {\r\n            x: stage.getPointerPosition().x / oldScale - stage.x() / oldScale,\r\n            y: stage.getPointerPosition().y / oldScale - stage.y() / oldScale\r\n        };\r\n\r\n        const newScale = e.evt.deltaY > 0 ? oldScale * scaleBy : oldScale / scaleBy;\r\n        if (newScale < this.state.minScaleValue) return;\r\n\r\n\r\n        stage.scale({ x: newScale, y: newScale });\r\n\r\n        this.setState({\r\n            stageScale: newScale,\r\n            stageX:\r\n                -(mousePointTo.x - stage.getPointerPosition().x / newScale) * newScale,\r\n            stageY:\r\n                -(mousePointTo.y - stage.getPointerPosition().y / newScale) * newScale\r\n        });\r\n\r\n        let layer = stage.getChildren()[0];\r\n        layer.absolutePosition(this.bound_function(\r\n            layer.absolutePosition()\r\n        ));        \r\n    };\r\n    \r\n    handleClick = (index) => {\r\n        return e => {\r\n            e.evt.preventDefault();\r\n            document.querySelector('.information-panel').scrollTop = 0;\r\n            this.setState({\r\n                inform: this.state.imageData.marks[index].mark_description_items,\r\n                markersOpacity: 0\r\n            });\r\n        }\r\n    };\r\n\r\n    handleBack = e => {\r\n        this.setState({\r\n            markersOpacity: 1\r\n        });\r\n    };\r\n\r\n\r\n    //для воспроизведения музыки\r\n    handleMove = e => {\r\n        e.evt.preventDefault();\r\n\r\n        const stage = e.target.getStage();\r\n        const layer = stage.getChildren()[0];\r\n\r\n        let x_pointer_position = stage.getPointerPosition().x - layer.absolutePosition().x;\r\n        let y_pointer_position = stage.getPointerPosition().y - layer.absolutePosition().y;\r\n\r\n        let current_height = this.state.imageData.height * \r\n                            this.state.stageScale;\r\n        let current_width = this.state.imageData.width * \r\n                            this.state.stageScale;\r\n\r\n        this.backgroundPlayer.change(\r\n            Math.trunc(x_pointer_position / current_width * \r\n                this.horizontal_parts_count), \r\n            Math.trunc(y_pointer_position / current_height * \r\n                this.vertical_parts_count)\r\n        );\r\n\r\n        if (!!this.soundEffectsPlayer) {\r\n            this.soundEffectsPlayer.change(\r\n                Math.trunc(x_pointer_position / current_width * \r\n                    this.horizontal_parts_effects_count), \r\n                Math.trunc(y_pointer_position / current_height * \r\n                    this.vertical_parts_effects_count)\r\n            );\r\n        }\r\n    }\r\n\r\n    handleLeave = e => {\r\n        e.evt.preventDefault();\r\n\r\n        this.backgroundPlayer.map_leaved();\r\n        if (!!this.soundEffectsPlayer)\r\n            this.soundEffectsPlayer.map_leaved();\r\n    }\r\n\r\n    getMarginLeft() {\r\n        if (this.state.markersOpacity === 0) {\r\n            return \"15px\";\r\n        }\r\n        return \"-100px\";\r\n\r\n    }\r\n\r\n    render() {\r\n        if(!this.state.loaded) {\r\n            return (\r\n                <MapLoader\r\n                    height={this.state.height}\r\n                >\r\n                </MapLoader>\r\n            )\r\n        }\r\n        if(!this.state.found || !this.state.imageData) {\r\n            return (\r\n                <PageNotFound/>\r\n            );\r\n        }\r\n\r\n        if (!this.state.interacted) {\r\n            return (\r\n                <div \r\n                    className={\"interaction-div\"}\r\n                    style={{\r\n                        \"height\": this.state.height\r\n                    }}\r\n                    onClick={e => {\r\n                        this.setState({\r\n                            interacted: 1\r\n                        });\r\n                    }}\r\n                >\r\n                    <div>Нажмите, чтобы начать</div>\r\n                </div>\r\n            )\r\n        }\r\n        // Проблема: visible_width и visible_height не обновляются.\r\n        // Для воспроизведения нужно перезагрузить страницу с открытым режимом разработчика, а затем выклюить его.\r\n        // В таком случае часть экрана никак не будет заполнена изображением.\r\n        let visible_width = window.innerWidth;\r\n        let visible_height = this.state.height;\r\n\r\n        let markers = null;\r\n        if (this.state.markersView) {\r\n            markers = this.state.imageData.marks.map(\r\n                // handleClick каррируется\r\n                // туда передается только index, аргумент e попадает при нажатии\r\n                (mark_props, index) => marker(Object.assign(mark_props,\r\n                    {\r\n                        handler: this.handleClick(index),\r\n                        opacity: this.state.markersOpacity\r\n                    }))\r\n            );\r\n        }\r\n\r\n        return (\r\n            <main>\r\n                <SettingPanel \r\n                    changeVisability={this.changeMarkersVisability}\r\n                    showSummary={this.showSummary}\r\n                    changePlaying={\r\n                        () => {\r\n                            if (this.backgroundPlayer.stopped) {\r\n                                this.backgroundPlayer.unstop();\r\n                                if (this.soundEffectsPlayer)\r\n                                    this.soundEffectsPlayer.unstop();\r\n                                return;\r\n                            }\r\n                            this.backgroundPlayer.stop();\r\n                            if (this.soundEffectsPlayer)\r\n                                this.soundEffectsPlayer.stop();\r\n                            return this.backgroundPlayer.stopped;\r\n                        }\r\n                    }\r\n                />\r\n                <div\r\n                    className={\"back-button\"}\r\n                    onClick={this.handleBack}\r\n                    style={{\r\n                        \"margin-left\": this.getMarginLeft()\r\n                    }}\r\n                >\r\n                </div>\r\n                <InformationPanel\r\n                    source={this.state.inform}\r\n                    show={1 - this.state.markersOpacity}\r\n                    height={visible_height}\r\n                />\r\n    \r\n                <Stage\r\n                    width={visible_width}\r\n                    height={this.state.height}\r\n                    onWheel={this.handleWheel}\r\n                    scaleX={this.state.stageScale}\r\n                    scaleY={this.state.stageScale}\r\n                    x={this.state.stageX}\r\n                    y={this.state.stageY}\r\n                >\r\n                    <Layer \r\n                        draggable \r\n                        dragBoundFunc={this.bound_function}\r\n                        onMouseMove={this.handleMove}\r\n                        onMouseLeave={this.handleLeave}\r\n                        ref={this.processLayerPosition}\r\n                        >\r\n                        <Image\r\n                            image={this.state.image}\r\n                        />\r\n                        {markers}\r\n                    </Layer>\r\n                </Stage>\r\n            </main>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Map;","export const USER_DATA = 'user_data'; \r\nexport const CHANGE_HEIGHT = 'change_height';\r\n\r\nexport function setUserData(user_data) {\r\n    return {\r\n        type: USER_DATA,\r\n        user_data: {\r\n            user_name: user_data? user_data.username : undefined,\r\n            user_email: user_data? user_data.email : undefined,\r\n            user_profile: user_data? user_data.profile : undefined\r\n        }\r\n    }\r\n}\r\n\r\nexport function setHeight(height) {\r\n    return {\r\n        type: CHANGE_HEIGHT,\r\n        height: height\r\n    }\r\n}\r\n\r\n","import 'bootstrap/dist/css/bootstrap.min.css';\r\nimport React, { Component } from 'react';\r\nimport { Button, Form, FormGroup, Label, Input} from 'reactstrap';\r\n\r\nimport './styles.css';\r\nimport * as Constants from '../../constants/constants'\r\n\r\nclass AuthorizationForm extends Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            height: 0,\r\n            login: '',\r\n            password: '',\r\n            error: ''\r\n        };\r\n        this.handleLoad = this.handleLoad.bind(this);\r\n        this.submitForm = this.submitForm.bind(this);\r\n        this.handleChange = this.handleChange.bind(this);\r\n    }\r\n\r\n    // загрузка окна\r\n    handleLoad = (e) => {\r\n        let height = window.innerHeight - document.getElementsByTagName('header')[0].clientHeight -\r\n            document.getElementsByTagName('footer')[0].clientHeight;\r\n        console.log(height);\r\n        this.setState({\r\n            height: height\r\n        });\r\n    };\r\n\r\n    componentDidMount() {\r\n        if (document.getElementsByTagName('header') &&\r\n            document.getElementsByTagName('footer')){\r\n            let height = window.innerHeight - document.getElementsByTagName('header')[0].clientHeight -\r\n                document.getElementsByTagName('footer')[0].clientHeight;\r\n            this.setState({\r\n                height: height\r\n            });\r\n        }\r\n        else {\r\n            window.addEventListener('load', this.handleLoad);\r\n        }\r\n    }\r\n\r\n    handleChange = async (e) => {\r\n        const {target} = e;\r\n        this.setState({\r\n            [target.name]: target.value\r\n        });\r\n    };\r\n\r\n\r\n    submitForm = (e) => {\r\n        e.preventDefault();\r\n        const data = {\r\n            'username': this.state.login,\r\n            'password': this.state.password\r\n        };\r\n        this.setState({\r\n            'password': '',\r\n            'error': ''\r\n        });\r\n        \r\n        \r\n        if (!data.username) {\r\n            this.setState({\r\n                error: 'Введите имя пользователя.'\r\n            });\r\n            return;\r\n        }\r\n        if (!data.password) {\r\n            this.setState({\r\n                error: 'Введите пароль.'\r\n            });\r\n            return;\r\n        } \r\n        fetch(Constants.LOGIN_ENDPOINT, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify(data),\r\n        })\r\n            .then(response => {\r\n                return response.ok ? response.json() : Promise.reject(response);\r\n            })\r\n            .then(data => {\r\n                localStorage.setItem('token', data['token']);\r\n                this.props.enter(data.user);\r\n            })\r\n            .catch(response => {\r\n                response.json().then(data => {\r\n                    for (let i in Object.keys(data)) {\r\n                        let error_array = data[Object.keys(data)[i]];\r\n                        for (let j in error_array) {\r\n                            this.setState({\r\n                                error: error_array[j]\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n    };\r\n\r\n    // Кажется, здесь не нужны handleChange, все будет в e.target при нажатии\r\n    render() {\r\n        let errorText = '';\r\n        if (this.state.error) {\r\n            errorText = (\r\n                <Label style={{color: 'red'}}>{this.state.error}</Label>\r\n            );\r\n        }\r\n        return (\r\n            <main>\r\n                <div className={'content-auth'}\r\n                    style={{\r\n                        height: this.state.height\r\n                    }}\r\n                >\r\n                    <div className={'form-wrapper'}>\r\n                        <Form onSubmit={this.submitForm} style={{'font-size': '10pt'}}>\r\n                            {errorText}\r\n                            <FormGroup col>\r\n                                <Label for=\"username\">Логин</Label>\r\n                                <Input \r\n                                    type=\"text\" \r\n                                    name=\"login\"\r\n                                    id=\"username\"\r\n                                    placeholder=\"Введите логин\" \r\n                                    value={this.state.login}\r\n                                    onChange={this.handleChange}\r\n                                />\r\n                            </FormGroup>\r\n                            <FormGroup col>\r\n                                <Label for=\"userPassword\">Password</Label>\r\n                                <Input \r\n                                    type=\"password\"\r\n                                    name=\"password\" \r\n                                    id=\"userPassword\" \r\n                                    placeholder=\"Введите пароль\" \r\n                                    value = {this.state.password}\r\n                                    onChange={this.handleChange}\r\n                                />\r\n                            </FormGroup>\r\n                            <Button>Войти</Button>\r\n                        </Form>\r\n                    </div>\r\n                </div>\r\n            </main>\r\n        );\r\n    }\r\n}\r\n\r\nexport default AuthorizationForm;","import { connect } from 'react-redux';\r\nimport { setUserData } from \"../actions\";\r\nimport AuthorizationForm from \"../../components/authorization\";\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n        user_data: state.user_data\r\n    };\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n    return {\r\n        enter: (user_data) => {\r\n            dispatch(setUserData(user_data))\r\n        }\r\n    };\r\n};\r\n\r\nconst AuthorizationFormContainer = connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(AuthorizationForm)\r\n\r\nexport default AuthorizationFormContainer;","import 'bootstrap/dist/css/bootstrap.min.css';\r\nimport React, { Component } from 'react';\r\nimport { Button, Form, FormGroup, Label, Input} from 'reactstrap';\r\n\r\nimport './styles.css';\r\nimport * as Constants from '../../constants/constants'\r\n\r\nclass RegistrationForm extends Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            height: 0,\r\n            login: '',\r\n            password: '',\r\n            email: '',\r\n            error: ''\r\n        };\r\n        this.handleLoad = this.handleLoad.bind(this);\r\n        this.submitForm = this.submitForm.bind(this);\r\n        this.handleChange = this.handleChange.bind(this);\r\n    }\r\n\r\n    // загрузка окна\r\n    handleLoad = (e) => {\r\n        let height = window.innerHeight - document.getElementsByTagName('header')[0].clientHeight -\r\n            document.getElementsByTagName('footer')[0].clientHeight;\r\n        console.log(height);\r\n        this.setState({\r\n            height: height\r\n        });\r\n    };\r\n\r\n    componentDidMount() {\r\n        if (document.getElementsByTagName('header') &&\r\n            document.getElementsByTagName('footer')){\r\n            let height = window.innerHeight - document.getElementsByTagName('header')[0].clientHeight -\r\n                document.getElementsByTagName('footer')[0].clientHeight;\r\n            this.setState({\r\n                height: height\r\n            });\r\n        }\r\n        else {\r\n            window.addEventListener('load', this.handleLoad);\r\n        }\r\n    }\r\n\r\n    handleChange = async (e) => {\r\n        const {target} = e;\r\n        this.setState({\r\n            [target.name]: target.value\r\n        });\r\n    };\r\n\r\n\r\n    submitForm = async (e) => {\r\n        e.preventDefault();\r\n        const data = {\r\n            'username': this.state.login,\r\n            'email': this.state.email,\r\n            'password': this.state.password\r\n        };\r\n        \r\n        this.setState({\r\n            'password': '',\r\n            'error': ''\r\n        });\r\n\r\n        if (!data.username) {\r\n            this.setState({\r\n                error: 'Введите имя пользователя.'\r\n            });\r\n            return;\r\n        }\r\n        if (!data.password) {\r\n            this.setState({\r\n                error: 'Введите пароль.'\r\n            });\r\n            return;\r\n        } \r\n        if (!data.email) {\r\n            this.setState({\r\n                error: 'Введите email.'\r\n            });\r\n            return;\r\n        }\r\n\r\n        fetch(Constants.REGISTER_ENDPOINT, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify(data),\r\n        })\r\n            .then(response => {\r\n                return response.ok ? response.json() : Promise.reject(response);\r\n            })\r\n            .then(data => {\r\n                localStorage.setItem('token', data['token']);\r\n                this.props.enter(data.user);\r\n            })\r\n            .catch(response => {\r\n                response.json().then(data => {\r\n                    for (let i in Object.keys(data)) {\r\n                        let error_array = data[Object.keys(data)[i]];\r\n                        for (let j in error_array) {\r\n                            this.setState({\r\n                                error: error_array[j]\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n    };\r\n\r\n    // Кажется, здесь не нужны handleChange, все будет в e.target при нажатии\r\n    render() {\r\n        let errorText = '';\r\n        if (this.state.error) {\r\n            errorText = (\r\n                <Label style={{color: 'red'}}>{this.state.error}</Label>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <main>\r\n                <div className={'content-auth'}\r\n                    style={{\r\n                        height: this.state.height\r\n                    }}\r\n                >\r\n                    <div className={'form-wrapper'}>\r\n                        <Form onSubmit={this.submitForm} style={{\r\n                            'font-size': '10pt'\r\n                        }} >\r\n                            {errorText}\r\n                            <FormGroup>\r\n                                <Label for=\"username\">Логин</Label>\r\n                                <Input \r\n                                    type=\"text\" \r\n                                    name=\"login\"\r\n                                    id=\"username\"\r\n                                    placeholder=\"Введите логин\" \r\n                                    value={this.state.login}\r\n                                    onChange={this.handleChange}\r\n                                    size={'10pt'}\r\n                                />\r\n                            </FormGroup>\r\n                            <FormGroup>\r\n                                <Label for=\"userEmail\">Email</Label>\r\n                                <Input \r\n                                    type=\"email\" \r\n                                    name=\"email\"\r\n                                    id=\"userEmail\"\r\n                                    placeholder=\"Введите email\" \r\n                                    value={this.state.email}\r\n                                    onChange={this.handleChange}\r\n                                />\r\n                            </FormGroup>\r\n                            <FormGroup>\r\n                                <Label for=\"userPassword\">Password</Label>\r\n                                <Input \r\n                                    type=\"password\"\r\n                                    name=\"password\" \r\n                                    id=\"userPassword\" \r\n                                    placeholder=\"Введите пароль\" \r\n                                    value = {this.state.password}\r\n                                    onChange={this.handleChange}\r\n                                />                            \r\n                            </FormGroup>\r\n                            <Button>Зарегистрироваться</Button>\r\n                        </Form>\r\n                    </div>\r\n                </div>\r\n            </main>\r\n        );\r\n    }\r\n}\r\n\r\nexport default RegistrationForm;","import { connect } from 'react-redux';\r\nimport { setUserData } from \"../actions\";\r\nimport RegistartionForm from \"../../components/registration\";\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n        user_data: state.user_data\r\n    };\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n    return {\r\n        enter: (user_data) => {\r\n            dispatch(setUserData(user_data))\r\n        }\r\n    };\r\n};\r\n\r\nconst RegistartionFormContainer = connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(RegistartionForm)\r\n\r\nexport default RegistartionFormContainer;","import React from 'react';\r\nimport { Route, Switch, withRouter } from 'react-router';\r\nimport Main from \"./../components/main\";\r\nimport Gallery from \"./../components/gallery\";\r\nimport PageNotFoundContainer from \"./../redux-components/containers/pageNotFoundContainer\";\r\nimport Map from \"./../components/map\";\r\nimport AuthorizationFormContainer from \"../redux-components/containers/authorizationContainer\";\r\nimport RegistrationFormContainer from \"../redux-components/containers/registrationContainer\"\r\n\r\nconst MainRouter = () => (\r\n    <Switch>\r\n        <Route exact path='/' component={Main}/>\r\n        <Route exact path='/gallery' component={Gallery}/>\r\n        <Route path=\"/maps/:name\" component={Map}/>\r\n        <Route path=\"/authorization\" component={AuthorizationFormContainer}/>\r\n        <Route path=\"/registration\" component={RegistrationFormContainer} />\r\n        <Route path='*' component={PageNotFoundContainer}/>\r\n    </Switch>\r\n);\r\n\r\nexport default withRouter(MainRouter);","import React, {Component} from 'react';\r\nimport { Link } from \"react-router-dom\";\r\nimport './styles.css';\r\nimport * as Constants from \"../../constants/constants\";\r\n\r\n// Токен может протухнуть (кажется, ошибка 401 будет), и ничего не получится, надо будет получать новый\r\n// Как это работает: в настройках есть пункт JWT_EXPIRATION_DELTA, который говорит сколько проживет текущий токен,\r\n// Но как только истекает это время не обязательно заново проводить процедуру входа при помощи логина и пароля,\r\n// достаточно лишь обновить токен при помощи refresh_token - см. urls.py (кажется, надо послать текущий токен, и получишь новый).\r\n// Но такое обновление тоже нельзя делать вечно. Есть ограничение в виде параметра\r\n// JWT_REFRESH_EXPIRATION_DELTA, который говорит, как долго можно обновлять токен\r\n// с момента последнего входа при помощи логина и пароля.\r\n// Всю эту сложную логику можно попробовать реализовать прямо в компоненте header.\r\n// Или можно просто перед каждым запросом, требующим авторазации (пока это лишь получение текущего пользователя)\r\n// делать refresh токена.\r\n// P.S. в итоге было решено не обновлять токен, а сделать сроком жизни токена 1 день.\r\n\r\n\r\nclass Header extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            logged_in: localStorage.getItem('token') ? true : false,\r\n            username: '',\r\n        };\r\n        this.handleWindow = this.handleWindow.bind(this);\r\n    }\r\n\r\n\r\n    handleWindow = (e) => {\r\n        e.preventDefault();\r\n        let height = window.innerHeight - document.getElementsByTagName('header')[0].clientHeight -\r\n            document.getElementsByTagName('footer')[0].clientHeight;\r\n        console.log(height);\r\n        this.props.setHeight(height);\r\n    };\r\n\r\n    componentDidMount() {\r\n        if (this.state.logged_in) {\r\n            fetch(Constants.CURRENT_USER_ENDPOINT, {\r\n                method: 'GET',\r\n                headers: {\r\n                    'Authorization': `Bearer ${localStorage.getItem('token')}`,\r\n                },\r\n            })\r\n                .then(response => {\r\n                    const res = response.json();\r\n                    if (!response.ok) {\r\n                        //do nothing\r\n                    }\r\n                    return res;\r\n                })\r\n                .then(data => {\r\n                    this.setState({username: data['username']});\r\n                    this.props.enter(data);\r\n                })\r\n            }\r\n        if (document.getElementsByTagName(\"footer\") &&\r\n            document.getElementsByTagName(\"header\")){\r\n            let height = window.innerHeight - document.getElementsByTagName('header')[0].clientHeight -\r\n                document.getElementsByTagName('footer')[0].clientHeight;\r\n            this.props.setHeight(height);\r\n        }\r\n        else {\r\n            window.addEventListener('load', this.handleWindow);\r\n        }\r\n\r\n        window.addEventListener('resize', this.handleWindow);\r\n    }\r\n\r\n    render() {\r\n\r\n        let userDiv = null;\r\n        if (!this.props.user_name) {\r\n                userDiv = (\r\n                    <div className={'user-div'}>\r\n                        <div\r\n                            className={'enter button'}\r\n                        >\r\n                            <Link to='/authorization'>\r\n                                <span className='button-text'>Войти</span>\r\n                            </Link> \r\n                        </div>\r\n                        <div className={'register button'}>\r\n                            <Link to='/registration'>\r\n                                <span className='button-text'>Зарегистрироваться</span>\r\n                            </Link>\r\n                        </div>\r\n                    </div>\r\n                );\r\n        }\r\n        else {\r\n            userDiv = (\r\n              <div className={'user-div'}>\r\n                  <span>Вы: {this.props.user_name}</span>\r\n                  <div\r\n                      className={'escape button'}\r\n                      onClick={e => {\r\n                          e.preventDefault();\r\n                          this.props.onEscapeClick();\r\n                      }}\r\n                  >\r\n                      Выйти\r\n                  </div>\r\n              </div>\r\n            );\r\n        }\r\n\r\n\r\n        return (\r\n            <header>\r\n                <div className=\"header-right\">\r\n                    <nav className=\"primary-nav\">\r\n                        <ul>\r\n                            <li className=\"logo\">\r\n                                <Link to=\"/\">\r\n                                        <span className=\"g-logo\">G</span>\r\n                                        <span className=\"z-logo\">Z</span>\r\n                                </Link>\r\n                            </li>\r\n                            <li className=\"typical\">\r\n                                <Link to=\"/gallery\">Галерея</Link>\r\n                            </li>\r\n                        </ul>\r\n                    </nav>\r\n                </div>\r\n                <div className=\"header-left\">\r\n                    {userDiv}\r\n                </div>\r\n            </header>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Header;","import { connect } from 'react-redux';\r\nimport { setUserData, setHeight } from \"../actions\";\r\nimport Header from \"../../components/header\";\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n        user_name: state.user_data.user_name\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n    return {\r\n        enter: (user_data) => {\r\n            dispatch(setUserData(user_data));\r\n        },\r\n        onEscapeClick: () => {\r\n            localStorage.removeItem('token');\r\n            dispatch(setUserData(undefined));\r\n        },\r\n        setHeight: (height) => {\r\n            dispatch(setHeight(height));\r\n        }\r\n    };\r\n};\r\n\r\nconst HeaderContainer = connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(Header);\r\n\r\nexport default HeaderContainer;","import React, {Component} from 'react';\r\nimport './styles.css';\r\n\r\nclass Footer extends Component {\r\n\r\n    componentDidMount() {\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <footer>\r\n                <p>\r\n                    © Gaze.com 2019-2020\r\n                </p>\r\n            </footer>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Footer;","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. Index is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import { USER_DATA, CHANGE_HEIGHT } from \"../actions\";\r\n\r\nconst initialState = {\r\n    user_data: {\r\n        user_name: undefined,\r\n        user_email: undefined,\r\n        user_profile: undefined,\r\n    },\r\n    height: 0\r\n};\r\n\r\nfunction reducer(state = initialState, action) {\r\n    switch (action.type) {\r\n        case USER_DATA:\r\n            return Object.assign({}, state, {user_data: action.user_data});\r\n        case CHANGE_HEIGHT:\r\n            return Object.assign({}, state, {height: action.height});\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\nexport default reducer;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport { BrowserRouter } from 'react-router-dom';\r\nimport MainRouter from './routes';\r\nimport HeaderContainer from \"./redux-components/containers/headerContainer.js\";\r\nimport Footer from \"./components/footer\";\r\nimport * as serviceWorker from './serviceWorker';\r\nimport {Provider} from 'react-redux';\r\nimport { createStore} from \"redux\";\r\nimport reducer from \"./redux-components/reducers\";\r\n\r\nlet store = createStore(reducer);\r\n\r\nconst render = () =>\r\n    ReactDOM.render(\r\n        <React.Fragment>\r\n            <BrowserRouter>\r\n                <Provider store={store}>\r\n                    <HeaderContainer />\r\n                    <MainRouter/>\r\n                    <Footer/>\r\n                </Provider>\r\n            </BrowserRouter>\r\n        </React.Fragment>,\r\n        document.getElementById('root')\r\n    );\r\nrender();\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();"],"sourceRoot":""}